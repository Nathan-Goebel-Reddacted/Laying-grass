#include "Player.hpp"
#include "Board.hpp"
#include "Cell.hpp"
#include "Piece.hpp"
#include <iostream>
#include <random>
#include <algorithm>
#include <queue>
#include <stdexcept>

Piece::Piece(int id)
    : id(id), shape(get_shape_by_id(id)), coor_x(0), coor_y(0) {}

Piece::~Piece() {}

void Piece::shape_rotate() {
    // Rotate 90 degrees clockwise by transposing and reversing each row
    std::vector<std::vector<int>> rotated(shape[0].size(), std::vector<int>(shape.size()));
    for (size_t i = 0; i < shape.size(); ++i) {
        for (size_t j = 0; j < shape[0].size(); ++j) {
            rotated[j][shape.size() - 1 - i] = shape[i][j];
        }
    }
    shape = rotated;
}

void Piece::shape_flip() {
    // Flip horizontally by reversing each row
    for (auto& row : shape) {
        std::reverse(row.begin(), row.end());
    }
}

std::vector<std::vector<int>>& Piece::get_shape(){
    return shape;
}

void Piece::set_position(int x, int y) {
    coor_x = x;
    coor_y = y;
}

int Piece::get_x(){
    return coor_x;
}

int Piece::get_y(){
    return coor_y;
}

void Piece::display(){
        for (const auto& row : shape) {
            for (int cell : row) {
                std::cout << (cell ? "#" : " ");  // Using "â–ˆ" for filled, " " for empty
            }
            std::cout << std::endl;
        }
    }


// Define a centralized location for shapes
std::vector<std::vector<int>> Piece::get_shape_by_id(int id) {
    switch (id) {
        case 1:
            return {{0,0,0},
                    {0,1,0},
                    {1,1,1}};
        case 2:
            return {{0,1,0},
                    {0,1,0},
                    {1,1,1}};
        case 3:
            return {{0,1,0},
                    {1,1,1},
                    {0,1,0}};
        case 4:
            return {{0,0,1},
                    {1,1,1},
                    {1,0,0}};
        case 5:
            return {{0,1,0},
                    {0,1,0},
                    {1,1,1}};
        case 6:
            return {{1,1},
                    {1,1,}};
        case 7:
            return {{0,0,0},
                    {1,0,1},
                    {1,1,1}};
        case 8:
            return {{1,1,1}};
        case 9:
            return {{0,1},
                    {1,1},
                    {1,0}};
        case 10:
            return {{1,0},
                    {1,1}};
        case 11:
            return {{0,0,1},
                    {0,1,1},
                    {1,1,0}};
        case 12:
            return {{1,1}};
        case 13:
            return {{0,0,1,0,0},
                    {0,1,1,0,0},
                    {0,1,0,0,0},
                    {0,1,0,0,0},
                    {0,1,1,0,0}};
        case 14:
            return {{0,1,1,1,0},
                    {0,1,0,0,0},
                    {0,1,0,0,0},
                    {0,1,0,0,0},
                    {0,1,0,0,0}};
        case 15:
            return {{0,0,0,1,0},
                    {0,0,0,1,0},
                    {0,0,0,1,1},
                    {0,1,1,1,0},
                    {1,1,0,0,0}};
        case 16:
            return {{0,0,0,1},
                    {0,0,1,1},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 17:
            return {{0,1,0},
                    {1,1,1},
                    {1,1,0}};
        case 18:
            return {{1,1,1}};
        case 19:
            return {{0,1,0,0},
                    {0,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0}};
        case 20:
            return {{0,1,1},
                    {1,1,0},
                    {1,1,0}};
        case 21:
            return {{0,1,0},
                    {1,1,0},
                    {1,1,1}};
        case 22:
            return {{0,0,1,0},
                    {0,0,1,0},
                    {0,1,1,1},
                    {0,1,0,0}};
        case 23:
            return {{1,0},
                    {1,1}};
        case 24:
            return {{1,1,0},
                    {1,1,0},
                    {1,1,0}};
        case 25:
            return {{1,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0},
                    {0,1,0,0}};
        case 26:
            return {{1,0,0,0},
                    {1,1,0,0},
                    {0,1,1,0},
                    {0,0,1,1}};
        case 27:
            return {{0,0,0,0},
                    {1,1,1,1},
                    {0,0,0,0},
                    {0,0,0,0}};
        case 28:
            return {{0,1,0,0},
                    {0,1,1,1},
                    {0,0,0,1},
                    {0,0,0,1}};
        case 29:
            return {{0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0}};
        case 30:
            return {{0,1,0,0},
                    {0,1,1,0},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 31:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,1,1,1,0},
                    {0,1,0,1,0}};
        case 32:
            return {{1,1}};
        case 33:
            return {{0,0,0,0},
                    {1,0,0,0},
                    {1,1,1,0},
                    {1,0,1,1}};
        case 34:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,1,1,0,0},
                    {0,1,0,0,0},
                    {0,1,0,0,0}};
        case 35:
            return {{0,1,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,1,1},
                    {0,1,1,0,0},
                    {0,1,0,0,0}};
        case 36:
            return {{0,1,0,0},
                    {0,1,0,0},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 37:
            return {{0,1,0},
                    {1,1,0},
                    {1,0,0}};
        case 38:
            return {{0,0,0,0},
                    {1,0,0,1},
                    {1,1,1,1},
                    {0,1,0,0}};
        case 39:
            return {{0,0,0,0,0},
                    {0,0,0,1,1},
                    {1,0,0,0,1},
                    {1,1,1,1,1},
                    {0,0,0,0,0}};
        case 40:
            return {{1,0,0,0,0},
                    {1,0,0,0,0},
                    {1,0,0,0,0},
                    {1,1,0,0,0},
                    {0,1,1,1,1}};
        case 41:
            return {{0,1,1,0,0},
                    {0,0,1,1,0},
                    {0,1,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0}};
        case 42:
            return {{1,0,0},
                    {1,1,0},
                    {1,1,0}};
        case 43:
            return {{0,1,0,0},
                    {0,1,0,0},
                    {1,1,1,1},
                    {0,0,0,0}};
        case 44:
            return {{1,1},
                    {1,1}};
        case 45:
            return {{0,0,1,0},
                    {0,1,1,0},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 46:
            return {{1,1,1},
                    {0,1,0},
                    {1,1,0}};
        case 47:
            return {{0,0,0,0},
                    {1,1,1,1},
                    {0,0,0,0},
                    {0,0,0,0}};
        case 48:
            return {{0,1,0},
                    {1,1,1},
                    {0,0,0}};
        case 49:
            return {{1,0,0,0},
                    {1,0,0,0},
                    {1,1,1,1},
                    {0,0,0,0}};
        case 50:
            return {{0,1,1,0},
                    {1,1,0,0},
                    {0,1,1,1},
                    {0,0,0,0}};
        case 51:
            return {{0,0,1,0},
                    {0,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0}};
        case 52:
            return {{1,0,0},
                    {1,1,1},
                    {0,0,0}};
        case 53:
            return {{0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 54:
            return {{0,0,1,1,1},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {1,1,1,0,0}};
        case 55:
            return {{0,0,0,1,0,0},
                    {0,0,0,1,0,0},
                    {0,0,1,1,0,0},
                    {0,0,1,0,0,0},
                    {0,0,1,1,0,0},
                    {0,0,1,0,0,0}};
        case 56:
            return {{0,0,0,0},
                    {1,1,1,1},
                    {0,0,0,0},
                    {0,0,0,0}};
        case 57:
            return {{1,1,0,0},
                    {0,1,0,0},
                    {0,1,1,1},
                    {0,0,0,1}};
        case 58:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,1,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 59:
            return {{0,0,1},
                    {0,0,1},
                    {1,1,1}};
        case 60:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 61:
            return {{0,1,0,1},
                    {0,1,1,1},
                    {0,0,1,0},
                    {0,1,1,0}};
        case 62:
            return {{0,0,1,0},
                    {1,1,1,0},
                    {0,1,1,1},
                    {0,1,0,0}};
        case 63:
            return {{0,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0},
                    {1,1,1,0}};
        case 64:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 65:
            return {{1,1,0,0},
                    {0,1,0,0},
                    {0,1,0,1},
                    {1,1,1,1}};
        case 66:
            return {{0,0,0,1,0},
                    {0,0,1,1,0},
                    {0,1,1,0,0},
                    {0,1,0,0,0},
                    {0,1,1,0,0}};
        case 67:
            return {{0,0,1,1,0,0},
                    {0,0,1,0,0,0},
                    {0,0,1,0,0,0},
                    {0,0,1,0,0,0},
                    {0,1,1,0,0,0},
                    {0,1,0,0,0,0}};
        case 68:
            return {{0,0,0,0},
                    {1,0,1,0},
                    {1,1,1,1},
                    {0,0,0,0}};
        case 69:
            return {{1,1,0,0},
                    {0,1,0,1},
                    {0,1,0,1},
                    {0,1,1,1}};
        case 70:
            return {{0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 71:
            return {{0,1,0,0,0},
                    {0,1,0,1,0},
                    {0,1,1,1,1},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 72:
            return {{0,0,0,1,1,0,0},
                    {0,0,0,1,0,0,0},
                    {0,0,0,1,0,0,0},
                    {0,0,0,1,0,0,0},
                    {0,0,0,1,0,0,0},
                    {0,0,0,1,0,0,0},
                    {0,0,0,1,0,0,0}};
        case 73:
            return {{0,0,1,0},
                    {0,1,1,1},
                    {0,1,0,0},
                    {0,1,0,0}};
        case 74:
            return {{1,1}};
        case 75:
            return {{0,0,1},
                    {1,0,1},
                    {1,1,1}};
        case 76:
            return {{0,1,0},
                    {1,1,1},
                    {1,0,1}};
        case 77:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {1,1,1,1,1},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 78:
            return {{0,0,0,0,1,0},
                    {0,0,0,1,1,0},
                    {0,0,0,1,0,0},
                    {0,0,0,1,0,0},
                    {0,0,1,1,0,0},
                    {0,1,1,0,0,0}};
        case 79:
            return {{0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,1,0}};
        case 80:
            return {{0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,1,1,1,1},
                    {0,0,1,0,0}};
        case 81:
            return {{0,0,0,1,0},
                    {0,0,1,1,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0},
                    {0,0,1,0,0}};
        case 82:
            return {{0,0,1,1},
                    {0,0,1,0},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 83:
            return {{0,0,1,1,0,0},
                    {0,0,1,0,0,0},
                    {0,1,1,0,0,0},
                    {0,0,1,1,0,0},
                    {0,0,1,0,0,0},
                    {0,0,1,0,0,0}};
        case 84:
            return {{0,0,1,1,0,0},
                    {0,0,1,1,0,0},
                    {0,0,0,1,1,0},
                    {0,0,0,1,0,0},
                    {0,0,0,1,0,0},
                    {0,0,0,1,0,0}};
        case 85:
            return {{0,0,1,0},
                    {0,0,1,1},
                    {0,1,1,0},
                    {0,0,1,0}};
        case 86:
            return {{0,0,0,0},
                    {1,1,0,0},
                    {1,1,1,1},
                    {0,0,0,0}};
        case 87:
            return {{0,0,1,1},
                    {1,1,1,0},
                    {1,0,0,0},
                    {1,1,0,0}};
        case 88:
            return {{0,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0},
                    {1,1,0,0}};
        case 89:
            return {{0,1,0,0},
                    {0,1,0,0},
                    {1,1,1,0},
                    {0,1,0,0}};
        case 90:
            return {{0,1,1,1},
                    {0,1,0,1},
                    {0,1,0,0},
                    {0,1,1,0}};
        case 91:
            return {{0,0,1,0},
                    {0,0,1,1},
                    {0,1,1,0},
                    {0,1,0,0}};
        case 92:
            return {{1,0,0},
                    {1,1,0},
                    {1,1,1}};
        case 93:
            return {{0,1,0,0},
                    {0,1,0,0},
                    {0,1,0,0},
                    {0,1,1,0}};
        case 94:
            return {{0,1,0,0},
                    {1,1,1,1},
                    {1,0,0,0},
                    {0,0,0,0}};
        case 95:
            return {{0,0,1,1},
                    {0,1,1,0},
                    {0,1,0,0},
                    {0,1,0,0}};
        case 96:
            return {{0,0,1,0},
                    {0,1,1,0},
                    {0,1,0,0},
                    {0,1,1,0}};
        default:
            throw std::invalid_argument("Invalid piece ID");
    }
}
